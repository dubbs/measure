function Lexer(a){function b(){for(var a=[],b=0,c=this.state,e=this.index,f=this.input,g=0,h=d.length;h>g;g++){var i=d[g],j=i.start,k=j.length;if(!k||j.indexOf(c)>=0||c%2&&1===k&&!j[0]){var l=i.pattern;l.lastIndex=e;var m=l.exec(f);if(m&&m.index===e){var n=a.push({result:m,action:i.action,length:m[0].length});for(i.global&&(b=n);--n>b;){var o=n-1;if(a[n].length>a[o].length){var p=a[n];a[n]=a[o],a[o]=p}}}}}return a}"function"!=typeof a&&(a=Lexer.defunct);var c=[],d=[],e=0;this.state=0,this.index=0,this.input="",this.addRule=function(a,b,c){var e=a.global;if(!e){var f="g";a.multiline&&(f+="m"),a.ignoreCase&&(f+="i"),a=new RegExp(a.source,f)}return"[object Array]"!==Object.prototype.toString.call(c)&&(c=[0]),d.push({pattern:a,global:e,action:b,start:c}),this},this.setInput=function(a){return e=0,this.state=0,this.index=0,this.input=a,this},this.lex=function(){if(c.length)return c.shift();for(this.reject=!0;this.index<=this.input.length;){for(var d=b.call(this).splice(e),f=this.index;d.length&&this.reject;){var g=d.shift(),h=g.result,i=g.length;this.index+=i,this.reject=!1,e++;var j=g.action.apply(this,h);if(this.reject)this.index=h.index;else if("undefined"!=typeof j)switch(Object.prototype.toString.call(j)){case"[object Array]":c=j.slice(1),j=j[0];default:return i&&(e=0),j}}var k=this.input;if(f<k.length)if(this.reject){e=0;var j=a.call(this,k.charAt(this.index++));if("undefined"!=typeof j)return"[object Array]"===Object.prototype.toString.call(j)?(c=j.slice(1),j[0]):j}else this.index!==f&&(e=0),this.reject=!0;else{if(!d.length)break;this.reject=!0}}}}"object"==typeof module&&"object"==typeof module.exports&&(module.exports=Lexer),Lexer.defunct=function(a){throw new Error("Unexpected character at index "+(this.index-1)+": "+a)},function(window){function Measure(a){this.ml=a.ml}Measure.prototype.volumes={teaspoons:5,tablespoons:15,fluidounces:30,shots:44,gills:118,cups:237,pints:473,quarts:946,gallons:3785},Measure.prototype.units=function(){return this.totalByUnit("units")},Measure.prototype.drops=function(){return this.totalByUnit("drops")},Measure.prototype.teaspoons=function(){return this.totalByUnit("teaspoons")},Measure.prototype.tablespoons=function(){return this.totalByUnit("tablespoons")},Measure.prototype.fluidounces=function(){return this.totalByUnit("fluidounces")},Measure.prototype.jiggers=function(){return this.totalByUnit("jiggers")},Measure.prototype.gills=function(){return this.totalByUnit("gills")},Measure.prototype.cups=function(){return this.totalByUnit("cups")},Measure.prototype.pints=function(){return this.totalByUnit("pints")},Measure.prototype.fifths=function(){return this.totalByUnit("fifths")},Measure.prototype.quarts=function(){return this.totalByUnit("quarts")},Measure.prototype.gallons=function(){return this.totalByUnit("gallons")},Measure.prototype.add=function(a){var b=Measure.parseOptionsFromString(a);return this.ml+=b.ml,this},Measure.prototype.subtract=function(a){var b=Measure.parseOptionsFromString(a);return this.ml-=b.ml,this},Measure.prototype.multiply=function(a){return this.ml*=a,this},Measure.prototype.divide=function(a){return this.ml/=a,this},Measure.prototype.totalByUnit=function(a){var b=this.ml/this.volumes[a];return Math.round(100*(b+1e-5))/100},Measure.parseOptionsFromString=function(input){var lexer=new Lexer,num=0,obj={ml:0,g:0};return lexer.addRule(/[0-9.\/ -]+/g,function(lexeme){lexeme=lexeme.trim().replace("-"," ").split(" ").join("+"),num=eval(lexeme)}),lexer.addRule(/(millilitre?)/g,function(){obj.ml+=num}),lexer.addRule(/(litre?)/g,function(){obj.ml+=1e3*num}),lexer.addRule(/(teaspoons?|tsp\.|t\.)/g,function(){obj.ml+=5*num}),lexer.addRule(/(tablespoons?|tbsp\.|T\.)/g,function(){obj.ml+=15*num}),lexer.addRule(/(fluidounces?|fl\.oz\.)/g,function(){obj.ml+=30*num}),lexer.addRule(/(shots?)/g,function(){obj.ml+=44*num}),lexer.addRule(/(gills?|gi\.)/g,function(){obj.ml+=118*num}),lexer.addRule(/(cups?|C)/g,function(){obj.ml+=237*num}),lexer.addRule(/(pints?|pt\.)/g,function(){obj.ml+=473*num}),lexer.addRule(/(quarts?|qt\.)/g,function(){obj.ml+=946*num}),lexer.addRule(/(gallons?|gal\.)/g,function(){obj.ml+=3785*num}),lexer.addRule(/(kilograms?|kg\.?)/g,function(){obj.g+=1e3*num}),lexer.addRule(/(grams?|g\.?)/g,function(){obj.g+=num}),lexer.addRule(/(ounces?|oz\.)/g,function(){obj.g+=28*num}),lexer.addRule(/(pounds?|lbs\.?)/g,function(){obj.g+=454*num}),lexer.addRule(/[^0-9]+/g,function(){0===obj.ml&&0===obj.g&&(obj.units=num)}),lexer.addRule(/\s/g,function(){}),lexer.setInput(input),lexer.lex(),0===obj.ml&&delete obj.ml,0===obj.g&&delete obj.g,obj},Measure.createFromString=function(a){return a=Measure.parseOptionsFromString(a),new Measure(a)},Measure.createFromObject=function(a){return new Measure(a)};var measure=function(a){return"string"==typeof a?Measure.createFromString(a):"object"==typeof a?Measure.createFromObject(a):new Measure};window.measure=measure,window.Measure=Measure}(this);